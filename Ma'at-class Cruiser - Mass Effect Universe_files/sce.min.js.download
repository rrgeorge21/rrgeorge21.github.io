var scToolbar,scToolbarExclude;scOptions.sceditor_close_toolbar?scToolbarExclude=scToolbar="":(scToolbarExclude="youtube,date,time,email,cut,copy,paste,print",scToolbar="twemoji,giphy|bold,italic,underline,strike,size,color,bgcolor|alignment,bulletlist,orderedlist,indent,outdent,table|image,link,quote,spoiler|code,custom_bbcodes,source");var emoticons,emoticonsObj={};0<(emoticons=void 0===emoticons?[]:emoticons).length&&emoticons.forEach(function(e,t){emoticonsObj[e[0]]=e[1]});var textarea,sceController=function(t){var e,o,i,n,a,c,d,r,u,s,l,f,p,g=scOptions.max_fontsize,m={},h=91,b=179,v={sourceMode:function(e){return void 0===d||void 0===d.sourceMode?null:void 0===e?d.sourceMode():void d.sourceMode(e=!!e)},sourceButton:{init:function(){e=t("a.sceditor-button-source"),o=!!e.length,a=t("#disable_bbcode")},hide:function(){o&&e.hide()},setOnClick:function(){a.on("click",function(){a.is(":checked")?(c=v.sourceMode(),v.sourceMode(!0),o&&e.hide()):(c||v.sourceMode(!1),o&&e.show())})}},getDocroot:function(){return void 0!==l||(l="/"===location.pathname.substr(-1)?location.pathname:(p=location.pathname.lastIndexOf("/")+1,location.pathname.substr(0,p)),f=location.protocol+"//"+(""===location.username?"":location.username+(""===location.password?"":":"+location.password)+"@")+location.hostname+(""===location.port?"":":"+location.port)+l),l},emoticons:{init:function(){n=t("#disable_smilies")},setOnClick:function(){n.on("click",function(){n.is(":checked")?d.emoticons(!1):d.emoticons(!0)})}},css:{getBase:function(e){return e instanceof CSSStyleSheet&&(e===m&&void 0!==s||(p=(null===typeof e.href||null===e.href?location:e).href.match(/[^?]+\//),s=p[0],m=e),s)},realpath:function(e){if(0===e.length)return e;for(var t in 0!==e.indexOf("http://")&&0!==e.indexOf("https://")||(v.getDocroot(),0===e.indexOf(f)&&(e=e.substr(f.length))),p=e.split("/"),e=[],p)p.hasOwnProperty(t)&&"."!==p[t]&&""!==p[t]&&(".."===p[t]?e.pop():e.push(p[t]));return e=e.join("/")},getWindowStyles:function(){var e,t,o,i,n;for(r=document.styleSheets,u="blockquote,code{border-color: #{STYLE_SETTINGS_CONFIG_COLOUR_PICKER} !important;}spoiler{background-color: #f8f8f8;color: color: #676767;}code {background-color: #eeeeee;}blockquote {color: #676767;background-color: #f8f8f8;}blockquote blockquote {background-color: #ffffff;}blockquote blockquote blockquote {background-color: #f8f8f8;}blockquote blockquote blockquote blockquote {background-color: #ffffff;}blockquote blockquote blockquote blockquote blockquote {background-color: #f8f8f8;}blockquote blockquote blockquote blockquote blockquote blockquote {background-color: #ffffff;}blockquote blockquote blockquote blockquote blockquote blockquote blockquote {background-color: #f8f8f8;}blockquote blockquote blockquote blockquote blockquote blockquote blockquote blockquote {background-color: #ffffff;}",i=r.length,e=0;e<i;e++)if(this.getBase(r[e]),s===f)if(r[e].cssRules)for(n=(o=r[e].cssRules).length,t=0;t<n;t++)u+=this.fixUrlPathes(o[t].cssText);else u+=this.fixUrlPathes(r[e].cssText)},fixUrlPathes:function(e){return-1===e.indexOf("url")?e:p=e.replace(/url\s*\(\s*["']?([^)]+?)["']?\s*\)/g,function(e,t){return'url("'+v.css.realpath(s+t)+'")'})}}};return{getDiffh:function(){return h},setDiffh:function(e){h=e},getBodyH:function(){return b},setBodyH:function(e){b=e},getMaxFontsize:function(){return g},isMaxFontsizeSet:function(){return!!g},getInstance:function(){return d},getTextarea:function(){return i=void 0===i||!i.length?t('textarea[name="message"]'):i},setText:function(e){var t;d.val(e),textarea.data("sceditor")&&(e=(t=sceController.getTextarea().data("sceditor").editorIframe()).height(),editorAutoHeight(t,e,!0))},getText:function(){return d.val()},init:function(){this.getTextarea(),v.css.getWindowStyles();var e={plugins:"bbcode,mention,dragdrop,alignment",toolbarExclude:scToolbarExclude,toolbar:scToolbar,style:'" /><style type="text/css">'+u+'</style><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link href="//fonts.googleapis.com/css?family=Roboto|Roboto+Mono|Google+Sans: 400,500,600,700|Material+Icons|Google+Sans+Display" rel="stylesheet"><link rel="stylesheet" type="text/css" href="'+scOptions.u_css,resizeEnabled:!0,width:"100%",spellcheck:!0,enablePasteFiltering:!0,resizeWidth:!1,colors:"#000000,#444444,#666666,#999999,#CCCCCC,#EEEEEE,#F3F3F3,#FFFFFF|#FF0000,#FF9900,#FFFF00,#00FF00,#00FFFF,#0000FF,#9900FF,#FF00FF|#F4CCCC,#FCE5CD,#FFF2CC,#D9EAD3,#D0E0E3,#CFE2F3,#D9D2E9,#EAD1DC|#EA9999,#F9CB9C,#FFE599,#B6D7A8,#A2C4C9,#9FC5E8,#B4A7D6,#D5A6BD|#E06666,#F6B26B,#FFD966,#93C47D,#76A5AF,#6FA8DC,#8E7CC3,#C27BA0|#CC0000,#E69138,#F1C232,#6AA84F,#45818E,#3D85C6,#6651A5,#A64D79|#990000,#B45F06,#BF9000,#38761D,#134F5C,#0B5394,#351C75,#741B47|#660000,#783F04,#7F6000,#274E13,#0C343D,#073763,#20124D,#4C1130"};scOptions.smilies_allowed&&0<emoticons.length?(e.emoticonsRoot=scOptions.u_emoticons_root,e.emoticons={dropdown:emoticonsObj},e.closePreLoadEmoticon=!0):e.emoticonsEnabled=!1,scOptions.quick_reply&&(e.height="180px"),i.sceditor(e),t(".sceditor-container:eq(0)").css("z-index",1),t("#notification_list").css("z-index",20),d=i.sceditor("instance"),v.sourceButton.init(),scOptions.bbcode_allowed?(""!=scOptions.bbcode_checked&&v.sourceMode(!0),v.sourceButton.setOnClick()):(v.sourceButton.hide(),scOptions.quick_reply||v.sourceMode(!0)),scOptions.smilies_allowed&&(v.emoticons.init(),""!=scOptions.smilies_checked&&d.emoticons(!1),v.emoticons.setOnClick())},setFocus:function(){var e,t,o;d.focus(),!i.data("sceditor")||(t=(e=i.data("sceditor").getRangeHelper()).cloneSelected())&&"selectNodeContents"in t&&(o=i.data("sceditor").getBody()[0].children,t.selectNodeContents(o[o.length-1]),t.collapse(!1),e.selectRange(t))},destroy:function(){d instanceof Object&&d.hasOwnProperty("destroy")&&d.destroy()},replaceUnicodeEmojiToImg:function(e){!0!==e&&!1!==d.sourceMode()||d.val(replaceUnicodeEmoji(d.val()))}}}(jQuery),sizes=["25","50","75","100","150","175","200"];function _stripFontFamily(e){return'"'+(e=e&&e.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2")).replace(/\"/g,"")+'"'}$.sceditor.plugins.bbcode.bbcode.set("size",{format:function(e,t){var o=0,i=e.data("scefontsize");return i||(-1<(e=e.css("fontSize")).indexOf("px")?31<(e=~~e.replace("px",""))?o=6:23<e?o=5:17<e?o=4:15<e?o=3:12<e?o=2:9<e&&(o=1):o=~~e,6<o?o=6:o<0&&(o=0),i=sizes[o]),"[size="+i+"]"+t+"[/size]"},html:function(e,t,o){return'<span data-scefontsize="'+t.defaultattr+'" style="font-size:'+t.defaultattr+'%">'+o+"</span>"}}),$.sceditor.plugins.bbcode.bbcode.set("font",{format:function(e,t){var o;return"[font="+_stripFontFamily(o=!e.is("font")||!(o=e.attr("face"))?e.css("font-family"):o)+"]"+t+"[/font]"},html:'<font face="{defaultattr}">{0}</font face="{defaultattr}">'}),$.sceditor.command.set("size",{_dropDown:function(t,e,o){var i=new Array;i[1]=t._("Smaller"),i[2]=t._("Small"),i[3]=t._("Normal"),i[4]=t._("Large"),i[5]=t._("Larger");function n(e){o($(this).data("size")),t.closeDropDown(!0),e.preventDefault()}for(var a=$("<div />"),c=1;c<6;c++)a.append($('<a class="sceditor-fontsize-option" data-size="'+c+'" href="#">'+i[c]+"</a>").click(n));t.createDropDown(e,"fontsize-picker",a)},txtExec:function(e){var t=this;$.sceditor.command.get("size")._dropDown(t,e,function(e){6<(e=~~e)?e=6:e<0&&(e=0),t.insertText("[size="+sizes[e]+"]","[/size]")})}}),$.sceditor.command.set("image",{_dropDown:function(o,e,i){var n=$('<div><label for="link">'+o._("URL:")+'</label> <input type="text" id="image" placeholder="http://" /></div><div><input type="button" class="button insertURL" value="'+o._("Insert")+'" /><p>To attach an inline photo or a file, please use Full Editor.</p></div>');(n="function"==typeof canUploadWithAutoInline&&canUploadWithAutoInline()?$('<div><p unselectable="on">To upload an inline photo or a file:</p><input type="button" class="button insertAttachment" value="Upload"><p style="margin-top: 20px;"></p></div><div><label for="link">'+o._("Or input an existing URL:")+'</label> <input type="text" id="image" placeholder="http://" /></div><div><input type="button" class="button insertURL" value="'+o._("Insert")+'" /></div>'):n).find(".button.insertURL").click(function(e){gaSendEvent("post_features","image","input-url");var t=n.find("#image").val();t&&i(t),o.closeDropDown(!0)}),o.createDropDown(e,"insertimage",n),n.find(".button.insertAttachment").click(function(e){o.closeDropDown(!0),gaSendEvent("post_features","image","upload-inline"),startUploadWithAutoInline()})},exec:function(e){var t=this;gaSendEvent("post_features","image","icon"),$.sceditor.command.get("image")._dropDown(t,e,function(e){t.wysiwygEditorInsertHtml('<img src="'+e+'" />')})},txtExec:function(e){var t=this;$.sceditor.command.get("image")._dropDown(t,e,function(e){t.insert("[img]"+e+"[/img]")})}}),$.sceditor.command.set("link",{_dropDown:function(i,e,n){var a=$('<div><label for="link">'+i._("URL:")+'</label> <input type="text" id="link" placeholder="http://" /></div><div><label for="des">'+i._("Description (optional):")+'</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="'+i._("Insert")+'" /></div>');a.find(".button").click(function(e){var t=a.find("#link").val(),o=a.find("#des").val();t&&(i.focus(),o=o||t,"http://"!==t.substr(0,7)&&"https://"!==t.substr(0,8)&&(t="http://"+t),n(t,o)),i.closeDropDown(!0),e.preventDefault()}),i.createDropDown(e,"insertlink",a)},exec:function(e){var o=this;gaSendEvent("post_features","link","icon"),$.sceditor.command.get("link")._dropDown(o,e,function(e,t){!o.getRangeHelper().selectedHtml()||t?(o.wysiwygEditorInsertHtml('<a href="'+e+'">'+(t=t||e)+"</a>"),sceController.setFocus()):o.execCommand("createlink",e)})},txtExec:function(e){var o=this;$.sceditor.command.get("link")._dropDown(o,e,function(e,t){o.insertText("[url="+e+"]"+t+"[/url]")})}}),$.sceditor.command.set("source",{_dropDown:function(t,e,o,i){var n=new Array;n[1]=t._("View as Original Post"),n[2]=t._("View as WYSIWYG");var a=$("<div />");a.append($('<a class="sceditor-source-option" data-source="'+i+'" href="#">'+n[i]+"</a>").click(function(e){o($(this).data("source")),t.closeDropDown(!0),e.preventDefault()})),t.createDropDown(e,"source-picker",a)},txtExec:function(e){var t=this;e.context?$.sceditor.command.get("source")._dropDown(t,e,function(e){t.sourceMode(!1),sceController.replaceUnicodeEmojiToImg()},2):t.toggleSourceMode()},exec:function(e){var t=this;e.context?$.sceditor.command.get("source")._dropDown(t,e,function(e){t.sourceMode(!0)},1):t.toggleSourceMode()},shortcut:"Ctrl+Shift+S"});var addResizeEvent,button_title="Emojis",index=0,disable=!1,$win=$(window),createListEmojiDone=!1;function createListEmoji(e){createListEmojiDone||($emojiPopup=e.find("span"),$emojiPopup.parent().css("padding",0),$emojiPopup.emojiPopupArea({attributes:{dir:"ltr"},useInternalCDN:!1,standalone:!0,imageType:"svg",pickerPosition:"bottom",filtersPosition:"bottom",buttonTitle:"Use the Tab key to insert Emoji faster.",placeholder:"Message…",filters:{recent:{title:"Recently Used"},smileys_people:{title:"Smilies and People"},animals_nature:{title:"Animals and Nature"},food_drink:{title:"Food and Drink"},activity:{title:"Activities"},travel_places:{title:"Travel and Places"},objects:{title:"Objects"},symbols:{title:"Symbols"},flags:{icon:"flag_gb",title:"Flags"}},recentEmojis:!0},e),$emojiPopup.emojiPopupShow(),createListEmojiDone=!0)}function updatePosition(e,t){var o=t.offset().left,i=$win.width(),t={top:t.offset().top,marginTop:t.outerHeight()};i<o+260?(t.left="auto",t.right=0):(t.left=o,t.right="auto"),e.css(t)}function unicodetoString(e){if(-1<e.indexOf("-")){for(var t=[],o=e.split("-"),i=0;i<o.length;i++){var n=parseInt(o[i],16);n=65536<=n&&n<=1114111?(a=Math.floor((n-65536)/1024)+55296,c=(n-65536)%1024+56320,String.fromCharCode(a)+String.fromCharCode(c)):String.fromCharCode(n),t.push(n)}return t.join("")}if(65536<=(o=parseInt(e,16))&&o<=1114111){var a=Math.floor((o-65536)/1024)+55296,c=(o-65536)%1024+56320;return String.fromCharCode(a)+String.fromCharCode(c)}return String.fromCharCode(o)}function setSmilie(e){textarea.data("sceditor").insert(" "+e+" ")}function editorAutoHeight(e,t,o,i){var n,a,c=e[0],c=c.contentWindow||c.contentDocument.parentWindow;(n=c.document.body?$(c.document).innerHeight():n)&&(t<n&&n<550?a=n:550<=n?a=550:n<=t&&(a=t)),a&&a!=e.height()&&(e.height(a),o&&(a=sceController.getTextarea().data("sceditor").getToolBar().outerHeight(!0)+a+e.data("outerHeightOffset"),sceController.getTextarea().data("sceditor").dimensions("",a,!0))),""==sceController.getText()&&e.height("auto"),i||c.scrollTo(0,n)}$.sceditor.command.set("twemoji",{init:function(e){var t=$(".sceditor-twemoji"),o=e.closeDropDown;t.length||(o(),e.closeDropDown=function(){o.apply(o,arguments),t.is(":visible")&&t.hide()},(t=$("<div>",{class:"sceditor-dropdown sceditor-twemoji"}).click(function(e){e.stopPropagation()})).html("<span>Loading...</span>"),t.appendTo("body"),t.scrollTop(0))},emoji:function(e,t,o){var i=$(".sceditor-twemoji"),n=e.closeDropDown;gaSendEvent("post_features","emoji","icon"),i.length?(setTimeout(function(){createListEmoji(i),i.attr("clickevent")||(i.attr("clickevent","on"),i.on("click",".emojibtn .emojiImg",function(e){o(this.title,"emoji"),e.ctrlKey||i.hide()}),i.on("click",".smileybtn .smileyImg",function(e){o(this.title,"smiley"),e.ctrlKey||i.hide()}))},1e3),i.is(":hidden")?(e.closeDropDown(),i.show()):e.closeDropDown()):(n(),e.closeDropDown=function(){n.apply(n,arguments),i.is(":visible")&&i.hide()},(i=$("<div>",{class:"sceditor-dropdown sceditor-twemoji"}).click(function(e){e.stopPropagation()})).html("<span>Loading...</span>"),i.appendTo("body"),i.scrollTop(0),i.attr("clickevent","on"),i.on("click",".emojibtn .emojiImg",function(e){o(this.title,"emoji"),e.ctrlKey||i.hide()}),i.on("click",".smileybtn .smileyImg",function(e){o(this.title,"smiley"),e.ctrlKey||i.hide()})),$(".emojiPopupArea-scroll-area").scrollTop(2),updatePosition(i,t),addResizeEvent||(addResizeEvent=!0,$win.resize(function(){updatePosition(i,t)}))},exec:function(e){var o=this;$.sceditor.command.get("twemoji").emoji(o,e,function(e,t){"emoji"==t?o.insert('[emoji unicode-emoji="'+e.toLowerCase()+'"]'+e.toLowerCase()+"[/emoji]"):o.insert(" "+e+" ")})},txtExec:function(e){var o=this;$.sceditor.command.get("twemoji").emoji(o,e,function(e,t){"emoji"==t?o.insert(unicodetoString(e.toLowerCase())):o.insert(" "+e+" ")})},tooltip:button_title}),$.sceditor.command.set("giphy",{init:function(e){var t=$(".sceditor-giphy"),o=e.closeDropDown;t.length||(o(),e.closeDropDown=function(){o.apply(o,arguments),t.is(":visible")&&t.hide()},(t=$("<div>",{class:"sceditor-dropdown sceditor-giphy"}).click(function(e){e.stopPropagation()})).html("<span>Loading...</span>"),t.appendTo("body"),t.hide(),t.scrollTop(0))},giphy:function(e,t,o){var i=$(".sceditor-giphy"),n=e.closeDropDown;i.length?(gifactif.reset(),gifactif.editor=e,gifactif.callback=o,e.createDropDown(t,"gifactif",gifactif.dropDown),gifactif.trending(),$("#gifactif_search",gifactif.dropDown)[0].focus(),gaSendEvent("post_features","giphy","icon")):(n(),e.closeDropDown=function(){n.apply(n,arguments),i.is(":visible")&&i.hide()},(i=$("<div>",{class:"sceditor-dropdown sceditor-giphy"}).click(function(e){e.stopPropagation()})).html("<span>Loading...</span>"),i.appendTo("body"),i.scrollTop(0)),updatePosition(i,t),addResizeEvent||(addResizeEvent=!0,$win.resize(function(){updatePosition(i,t)}))},exec:function(e){var t=this;$.sceditor.command.get("giphy").giphy(t,e,function(e){t.insert("[img]"+e+"[/img]"),gaSendEvent("post_features","giphy","insert_wysiwyg")})},txtExec:function(e){var t=this;$.sceditor.command.get("giphy").emoji(t,e,function(e){t.insertText("[img]"+e+"[/img]"),gaSendEvent("post_features","giphy","insert_source")})},tooltip:"Gifs"}),$.sceditor.plugins.bbcode.bbcode.set("quote",{format:function(e,t){var o="",i="",n="",a=$(e),e=a.children("cite").first();return 1!==e.length&&!a.data("author")||(o=a.data("author")||e.text().replace(/(^\s+|\s+$)/g,"").replace(/:$/,""),a.data("author",o),e.remove(),t=this.elementToBbcode(a),o="="+o,a.prepend(e)),a.data("post_id")&&(i=a.data("post_id")||e.text().replace(/(^\s+|\s+$)/g,"").replace(/:$/,""),a.data("post_id",i),e.remove(),t=this.elementToBbcode(a),i=" post_id="+i,a.prepend(e)),a.data("time")&&(n=a.data("time")||e.text().replace(/(^\s+|\s+$)/g,"").replace(/:$/,""),a.data("time",n),e.remove(),t=this.elementToBbcode(a),n=" time="+n,a.prepend(e)),"[quote"+o+i+n+"]"+t+"[/quote]"},html:function(e,t,o){var i="";return void 0!==t.defaultattr?(o="<cite>"+t.defaultattr+":</cite>"+o,i=' data-author="'+t.defaultattr+'"',t.post_id&&(i+=' data-post_id="'+t.post_id+'"'),t.time&&(i+=' data-time="'+t.time+'"')):i=' class="uncited"',"<blockquote"+i+">"+o+"</blockquote>"},quoteType:function(e,t){return'"'+e.replace('"','\\"')+'"'},breakStart:!1,breakEnd:!1}),$.sceditor.plugins.bbcode.bbcode.set("mention",{allowsEmpty:!0,allowedChildren:["#"],tags:{span:{mention:null}},format:function(e,t){return t?"[mention]"+(t=-1!==(index=t.indexOf("@"))?t.substr(index+1):t)+"[/mention]":""},html:function(e,t,o){return o?'<span class="mention" mention="'+(o=-1!==(index=o.indexOf("@"))?o.substr(index+1):o)+'">@'+o+"</span>":""}}),$.sceditor.plugins.bbcode.bbcode.set("emoji",{allowsEmpty:!0,tags:{img:{"unicode-emoji":null}},format:function(e,t){return unicode=e.attr("unicode-emoji"),unicode?unicodetoString(unicode):t},html:function(e,t,o){return'<img class="emoji" unicode-emoji="'+t["unicode-emoji"]+'" style="width:24px;height:24px;" src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.2.7/assets/svg/'+t["unicode-emoji"]+'.svg" />'}}),$.sceditor.plugins.bbcode.bbcode.set("bgcolor",{tags:{span:{bgcolor:null}},format:function(e,t){return"[bgcolor="+e.attr("bgcolor")+"]"+t+"[/bgcolor]"},html:function(e,t,o){t=t.defaultattr;return'<span bgcolor="'+t+'" style="background-color:'+t+'">'+o+"</span>"},tooltip:"Highlight"}),$.sceditor.plugins.bbcode.bbcode.set("border",{tags:{span:{border:null}},format:function(e,t){return"[border="+e.attr("border")+"]"+t+"[/border]"},html:function(e,t,o){var i=t.defaultattr,t=i.split(","),n=void 0===t[0]?"":(n=t[0],"border:"+(void 0!==t[1]?t[1]:1)+"px "+(void 0!==t[2]?t[2]:"solid")+" "+n);return'<span border="'+i+'" style="'+n+'">'+o+"</span>"}}),$.sceditor.command.set("spoiler",{_dropDown:function(o,e,i){var n=$('<div><label for="title">'+o._("Spoiler Title:")+'</label> <input type="text" id="title" value="Spoiler:" /></div><div><input type="button" class="button" value="'+o._("Insert")+'" /></div>');n.find(".button").click(function(e){var t=n.find("#title").val();i(t),o.closeDropDown(!0)}),o.createDropDown(e,"insertspoiler",n)},exec:function(e){var t=this;gaSendEvent("post_features","spoiler","icon"),$.sceditor.command.get("spoiler")._dropDown(t,e,function(e){e.length?t.wysiwygEditorInsertHtml("<spoiler><cite>"+e+"</cite><br>","</spoiler>"):t.wysiwygEditorInsertHtml("<spoiler><cite>Spoiler</cite><br>","</spoiler>")})},txtExec:function(e){var t=this;$.sceditor.command.get("spoiler")._dropDown(t,e,function(e){e.length?t.insert("[spoiler="+e+"]","[/spoiler]"):t.insert("[spoiler]","[/spoiler]")})},tags:{spoiler:null},isInline:!1,forceNewLineAfter:["spoiler"],tooltip:"Insert a spoiler"}),$.sceditor.plugins.bbcode.bbcode.set("spoiler",{tags:{spoiler:null},isInline:!1,format:function(e,t){var o="",i=$(e),e=i.children("cite").first();return 1!==e.length&&!i.data("title")||(o=i.data("title")||e.text().replace(/(^\s+|\s+$)/g,"").replace(/:$/,""),i.data("title",o),e.remove(),t=this.elementToBbcode(i),o="="+o,i.prepend(e)),"[spoiler"+o+"]"+t+"[/spoiler]"},html:function(e,t,o){return"<spoiler>"+(o=t.defaultattr?"<cite>"+t.defaultattr+"</cite>"+o:"<cite>Spoiler:</cite>"+o)+"</spoiler>"},breakEnd:!0}),$.sceditor.command.set("custom_bbcodes",{_dropDown:function(t,e,o){function i(e){o($(this).data("custombbcode")),t.closeDropDown(!0),e.preventDefault()}for(var n=$("<div />"),a=0;a<custom_bbcodes.length;a++)n.append($('<a class="sceditor-custombbcodes-option" data-custombbcode="'+a+'" href="#"><span custombbcode="'+a+'">['+custom_bbcodes[a][1]+"]</span></a>").click(i));t.createDropDown(e,"custom_bbcodes",n)},txtExec:function(e){var t=this;$.sceditor.command.get("custom_bbcodes")._dropDown(t,e,function(e){e=~~e,t.sourceEditorInsertText.apply(t,new Array(bbtags[custom_bbcodes[e][0]],bbtags[custom_bbcodes[e][0]+1]))})},exec:function(e){var t=this;$.sceditor.command.get("custom_bbcodes")._dropDown(t,e,function(e){e=~~e,t.wysiwygEditorInsertHtml(bbtags[custom_bbcodes[e][0]],bbtags[custom_bbcodes[e][0]+1])})},tooltip:"Insert custom bbcode"}),$.sceditor.command.set("alignment",{_dropDown:function(t,e,o){var i=new Array;i[1]=t._("Left"),i[2]=t._("Center"),i[3]=t._("Right"),i[4]=t._("Justify");function n(e){o($(this).data("aligntype")),t.closeDropDown(!0),e.preventDefault()}for(var a=$("<div />"),c=1;c<5;c++)a.append($('<a class="sceditor-fontsize-option" data-aligntype="'+c+'" href="#"><span aligntype="'+c+'">'+i[c]+"</span></a>").click(n));t.createDropDown(e,"alignment",a)},txtExec:function(e){var o=this;$.sceditor.command.get("alignment")._dropDown(o,e,function(e){var t=new Array;t[1]=["[left]","[/left]"],t[2]=["[center]","[/center]"],t[3]=["[right]","[/right]"],t[4]=["[justify]","[/justify]"],o.sourceEditorInsertText.apply(o,t[e=~~e])})},exec:function(e){var o=this;$.sceditor.command.get("alignment")._dropDown(o,e,function(e){e=~~e;var t=new Array;t[1]="justifyleft",t[2]="justifycenter",t[3]="justifyright",t[4]="justifyfull";e=t[e];o.execCommand(e)})},tooltip:"Alignment"}),$.sceditor.plugins.dragdrop=function(){var e;function t(e){e.dataTransfer;e.preventDefault()}this.signalReady=function(){this.opts.dragdrop,(e=(e=this.getBody())[0]).addEventListener("dragover",t),e.addEventListener("dragleave",t),e.addEventListener("dragend",t),e.addEventListener("drop",t)}},$.sceditor.plugins.mention=function(){function a(e,t,o){var i,n,a,c,d,r="",u=e.startContainer,s=e.startOffset;for(u&&3!==u.nodeType&&(u=u.childNodes[s],s=0),a=c=s;o>r.length&&u&&3===u.nodeType;)i=u.nodeValue,n=o-r.length,d&&(c=i.length,a=0),d=u,u=t?(a=Math.max(c-n,0),r=i.substr(s=a,c-a)+r,d.previousSibling):(s=a+(c=Math.min(n,i.length)),r+=i.substr(a,c),d.nextSibling);return{node:d||u,offset:s,text:r}}var d,c=$("<div class='-autocomplete-list-container' style='display: none; position: absolute;'><ul class='-autocomplete-list'></ul></div>"),i=[9,13,27,38,40],n="undefined"==typeof U_AJAX_MENTION_URL?"./app.php/mentionloc/":U_AJAX_MENTION_URL,r=[],u=[],s=0,l=0,f=0;this.init=function(){$(document.body).append(c)},getUsersAndRenderMenuList=function(e,t,o){$.ajax({url:n,type:"get",data:{q:e},success:function(e){r=[],void 0!==e.length&&0<e.length?($.each(e,function(e,t){r.push({username:t.name,id:t.id,avatar:t.avatar})}),t==l&&renderMenuList(r,o)):hideMenuList()}})},renderMenuList=function(e,t){u=e;var o=c.find("ul").empty();if(len=e.length,0<len){for(var i=0;i<len;i++)o.append('<li class="-autocomplete-list-item" data-index="'+i+'" data-username="'+e[i].username+'"><i class="avatar-bg" style="background-image:url('+e[i].avatar+')"></i>'+e[i].username+"</li>");$("li.-autocomplete-list-item").click(function(e){e.preventDefault(),s=this.getAttribute("data-index"),highlightMenuItem(),selectMenuItem(t)}),s=0,highlightMenuItem(),showMenuList()}else hideMenuList()},selectMenuItem=function(e){e.focus();var t=e.getRangeHelper(),o=c.find(".-autocomplete-list-item").eq(s).data("username");!function(e,t){var o=this.cloneSelected();if(!o)return!1;o.collapse(!1),$.sceditor.ie&&$.sceditor.ie<9?(o.moveStart(CHARACTER,0-e),o.moveEnd(CHARACTER,t)):(e=a(o,!0,e),t=a(o,!1,t),o.setStart(e.node,e.offset),o.setEnd(t.node,t.offset)),this.selectRange(o)}.call(t,f+1,0),e.insert("[mention]"+o+"[/mention]");var i=(t=e.getRangeHelper()).cloneSelected();t.saveRange();var n=t.getMarker("sceditor-start-marker"),o=n.parentNode,e=n.ownerDocument.createElement("span");$(e).html("&nbsp;");n=o.parentNode;n.insertBefore(e,o),n.removeChild(o),n.insertBefore(o,e),t.restoreRange(),i.selectNodeContents(e),i.collapse(!1),t.selectRange(i),hideMenuList()},nextMenuItem=function(){s=(s+1)%u.length,highlightMenuItem()},prevMenuItem=function(){s=(s+r.length-1)%u.length,highlightMenuItem()},showMenuList=function(){c.css({left:d.left,top:d.top}),c.show()},hideMenuList=function(){s=0,c.hide()},highlightMenuItem=function(){c.find(".-autocomplete-list-item").removeClass("selected"),c.find(".-autocomplete-list-item").eq(s).addClass("selected")},hasValidChars=function(e){return!/\s+/.test(e)},this.signalKeydownEvent=function(e){if(c.is(":visible")&&!(i.indexOf(e.keyCode)<0)){switch(e.keyCode){case 9:case 13:selectMenuItem(this),l++;break;case 40:nextMenuItem();break;case 38:prevMenuItem();break;case 27:hideMenuList(),l++}e.preventDefault()}},this.signalKeyupEvent=function(e){var t,o;-1<i.indexOf(e.keyCode)||($(document.body),o=this.getRangeHelper(),(e=(t=function(e,t){var o=this.cloneSelected();return o?(o.collapse(!e),$.sceditor.ie&&$.sceditor.ie<9?(e?o.moveStart(CHARACTER,0-t):o.moveEnd(CHARACTER,t),o.text):a(o,e,t).text):""}.call(o,!0,31)).lastIndexOf("@"))<0?hideMenuList():(t=t.substr(e+1),f=t.length,l++,editor=this,(o=editor.getRangeHelper()).cloneSelected(),o.saveRange(),(e=o.getMarker("sceditor-start-marker").parentNode).parentNode,void 0!==(o=$(e)).attr("mention")&&o.attr("class")&&"mention"===o.attr("class")?o.attr("mention").length!==e.textContent.length-3&&e.parentNode.removeChild(e):(function(e){var t=e.getRangeHelper();t.saveRange();var o=t.getMarker("sceditor-start-marker"),i=o.parentNode,n=o.ownerDocument.createElement("span");$(n).text("b");for(var a=o.previousSibling;a;){var c=(a.nodeValue||"").lastIndexOf("@");if(-1<c){i.insertBefore(n,a.splitText(c+1));break}a=a.previousSibling}n.parentNode&&((d=$(n).offset()).top+=$(n).height(),$(n).remove()),t.restoreRange(),d&&(e=e.getContentAreaContainer().offset(),d.top+=e.top+15,d.left+=e.left+15)}(this),2<=t.length&&hasValidChars(t)?getUsersAndRenderMenuList(t,l,this):hideMenuList())))},this.signalBlurEvent=function(e){c.fadeOut("slow")}},$.sceditor.plugins.bbcode.bbcode.set("attachment",{allowsEmpty:!0,tags:{img:{"data-attachment-index":null},div:{"data-attachment-index":null}},format:function(e,t){var o=e.attr("filename");return(e=e.attr("data-attachment-index"))?"[attachment="+e+"]"+o+"[/attachment]":t},html:function(e,t,o){var i,n;if(t=void 0===t.index?parseInt(e.val.substr(12)):t.index,void 0!==phpbb.plupload.data[t]&&(i=phpbb.plupload.data[t].attach_id,n=phpbb.plupload.data[t].url),i)return phpbb.plupload.data[t].is_image?'<img class="attachment" src="'+n+'" data-attachment-index="'+t+'" filename="'+o+'" />':'<div class="attachment" data-attachment-index="'+t+'" filename="'+o+'" ><a  href="'+n+'" >'+o+"</a></div><br/>"}}),$(function(){var t=!!navigator.userAgent.match(/AppleWebKit.*Mobile.*/);function e(){textarea.data("sceditor")&&(640<=$(window).width()?$(".sceditor-toolbar").show():(sceController.getTextarea().data("sceditor").sourceMode(!0),$(".sceditor-toolbar").hide()))}!function(){{var u;sceController.init(),textarea=sceController.getTextarea(),$("#format-buttons").hide(),$("#smiley-box a img").each(function(){$(this).click(function(){return setSmilie($(this).attr("alt")),!1})}),void 0!==phpbb.plupload&&(u=phpbb.plupload.updateBbcode,phpbb.plupload.updateBbcode=function(e,i){var t,n=textarea.data("sceditor").val(),a="removal"===e;if(-1!==n.indexOf("[attachment=")){if(a)for(t=i;t<=phpbb.plupload.ids.length;t++)r(t);else for(t=phpbb.plupload.ids.length-1;i<=t;t--)r(t);""==n?textarea.data("sceditor").val(" "):textarea.data("sceditor").val(replaceUnicodeEmoji(n)),textarea.data("sceditor").focus();var o,c=textarea.data("sceditor").getRangeHelper(),d=c.cloneSelected();"selectNodeContents"in d&&(o=textarea.data("sceditor").getBody()[0].children,d.selectNodeContents(o[o.length-1]),d.collapse(!1),c.selectRange(d)),u(e,i)}function r(o){var e=new RegExp("\\[attachment="+o+"\\](.*?)\\[\\/attachment\\]","g");n=n.replace(e,function(e,t){return a&&i===o?"":"[attachment="+(o+(a?-1:1))+"]"+t+"[/attachment]"})}})}sceController.replaceUnicodeEmojiToImg(!0);var e=e||$("#file-list");e.on("click",".file-inline-bbcode",function(e){var t=$(this).parents(".attach-row").attr("data-attach-id"),t=phpbb.plupload.getIndex(t),t="[attachment="+t+"]"+phpbb.plupload.data[t].real_filename+"[/attachment]";textarea.data("sceditor").insert(t)}),(!t||640<=$(window).width())&&textarea.data("sceditor")&&setTimeout(function(){$.sceditor.command.get("twemoji").init(textarea.data("sceditor")),$.sceditor.command.get("giphy").init(textarea.data("sceditor"))},1e3)}(),$(window).resize(function(){e()}),e(),"undefined"!=typeof hasDoHtml&&hasDoHtml&&(sceController.getTextarea().data("sceditor").sourceMode(!0),$(".sceditor-button-source").hide()),("undefined"==typeof custom_bbcodes||custom_bbcodes.length<=0)&&$(".sceditor-button-custom_bbcodes").hide(),$(document).click(function(){$(".sceditor-twemoji").hide()}),$(".sceditor-twemoji").click(function(e){e.stopPropagation()}),$(document).click(function(){$(".sceditor-giphy").hide()}),$(".sceditor-giphy").click(function(e){e.stopPropagation()});var o,i,n,a=$(".multiselect");a.length?a.focus():textarea.data("sceditor")&&("posting"===SCRIPT_NAME&&textarea.data("sceditor").focus(),"selectNodeContents"in(c=(o=textarea.data("sceditor").getRangeHelper()).cloneSelected())&&(a=textarea.data("sceditor").getBody()[0].children,c.selectNodeContents(a[a.length-1]),c.collapse(!1),o.selectRange(c))),textarea.data("sceditor")&&!t&&(i=sceController.getTextarea().data("sceditor").editorIframe(),n=i.height(),editorAutoHeight(i,n,!0),textarea.data("sceditor").nodeChanged(function(e){editorAutoHeight(i,n,!1,!0)}));var c=$(".viewtopic_wrapper");return c&&c.find("em.mention").each(function(e,t){var o=(o=t.innerText).substr(1);t.innerHTML='<em class="mention"><a href="./memberlist.php?mode=viewprofile&un='+encodeURI(o)+'">'+t.innerText+"</a></em>"}),textarea});var asciiRegexp=/:[-+_a-z0-9]+(?=:)/g,unicodeRegexp=/(?:[#*0-9]\ufe0f\u20e3?|[\xa9\xae\u203c\u2049\u2122\u2139\u2194-\u2199\u21a9\u21aa\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb\u25fc\u2600-\u2604\u260e\u2611\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2660\u2663\u2665\u2666\u2668\u267b\u2692\u2694\u2696\u2697\u2699\u269b\u269c\u26a0\u26b0\u26b1\u26c8\u26cf\u26d1\u26d3\u26e9\u26f0\u26f1\u26f4\u26f7\u26f8\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u3030\u303d\u3297\u3299]\ufe0f|[\u231a\u231b\u23e9-\u23ec\u23f0\u23f3\u25fd\u25fe\u2614\u2615\u2648-\u2653\u267f\u2693\u26a1\u26aa\u26ab\u26bd\u26be\u26c4\u26c5\u26ce\u26d4\u26ea\u26f2\u26f3\u26f5\u26fa\u26fd\u2705\u2728\u274c\u274e\u2753-\u2755\u2757\u2795-\u2797\u27b0\u27bf\u2b1b\u2b1c\u2b50\u2b55]\ufe0f?|[\u261d\u26f9\u270c\u270d](?:\ud83c[\udffb-\udfff]|\ufe0f)|[\u270a\u270b](?:\ud83c[\udffb-\udfff]|\ufe0f)?|\ud83c(?:[\udc04\udccf\udd8e\udd91-\udd9a\ude01\ude1a\ude2f\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc2\udfc5-\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]\ufe0f?|[\udd70\udd71\udd7e\udd7f\ude02\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcc-\udfce\udfd4-\udfdf\udff3\udff5\udff7]\ufe0f|[\udde6-\uddff](?:\ud83c[\udde6-\uddff]|\ufe0f)?|[\udf85\udfc3\udfc4\udfca](?:\ud83c[\udffb-\udfff]|\ufe0f)?|\udfcb(?:\ud83c[\udffb-\udfff]|\ufe0f))|\ud83d(?:[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\udecc\uded0-\uded2\udeeb\udeec\udef4-\udef6]\ufe0f?|[\udc3f\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd74\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]\ufe0f|[\udc42\udc43\udc46-\udc50\udc66\udc67\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0](?:\ud83c[\udffb-\udfff]|\ufe0f)?|[\udd75\udd90](?:\ud83c[\udffb-\udfff]|\ufe0f)|\udc41(?:\u200d\ud83d\udde8|\ufe0f)|\udc68(?:\u200d(?:\u2764\ufe0f\u200d\ud83d(?:\udc8b\u200d\ud83d)?\udc68|\ud83d[\udc68\udc69]\u200d\ud83d(?:\udc66(?:\u200d\ud83d\udc66)?|\udc67(?:\u200d\ud83d[\udc66\udc67])?))|\ud83c[\udffb-\udfff]|\ufe0f)?|\udc69(?:\u200d(?:\u2764\ufe0f\u200d\ud83d(?:\udc8b\u200d\ud83d)?[\udc68\udc69]|\ud83d\udc69\u200d\ud83d(?:\udc66(?:\u200d\ud83d\udc66)?|\udc67(?:\u200d\ud83d[\udc66\udc67])?))|\ud83c[\udffb-\udfff]|\ufe0f)?)|\ud83e(?:[\udd10-\udd17\udd20-\udd25\udd27\udd3a\udd40-\udd45\udd47-\udd4b\udd50-\udd5e\udd80-\udd91\uddc0]\ufe0f?|[\udd18-\udd1e\udd26\udd30\udd33-\udd39\udd3c-\udd3e](?:\ud83c[\udffb-\udfff]|\ufe0f)?))(?!\ufe0e)/g;function getSequence(e){e=e.replace(/[\u200D\uFE0F]/g,"");var t=[],o=0;do{var i=e.charCodeAt(o)}while(55296<=i&&(i=(i<<10)+e.charCodeAt(++o)-56613888),t.push(("000"+i.toString(16)).replace(/^0+(.{4,})$/,"$1")),++o<e.length);return t.join("-")}function replaceUnicodeEmoji(e){if(e&&unicodeRegexp){unicodeRegexp.lastIndex=0;for(var t=e;i=unicodeRegexp.exec(e);)var o=i[0],i=(i.index,getSequence(o)),t=t.replace(o,'[emoji unicode-emoji="'+i.toLowerCase()+'"]'+i.toLowerCase()+"[/emoji]");return t}}window.gifactif?window.console&&console.warn&&console.warn("gifactif has already been initialized"):(window.gifactif={key:"vAJ5Oa0L3gO2R1SWtbBJgJQ31LOKqrFm",limit:26,delay:200,auto_close:!0,lang:{searching:"Searching...",not_found:'No results found.. <img src="http://illiweb.com/fa/i/smiles/icon_sad.gif" style="margin:0;vertical-align:middle;"/>'},dropDown:$('<div><input type="text" id="gifactif_search" placeholder="Search for a GIF..."/><div id="gifactif_results" onscroll="gifactif.scrolling(this);"><div id="gifactif_images"></div></div><div id="giphy_attribution_mark"></div></div>')[0],trending:function(){gifactif.timeout&&gifactif.abort(),gifactif.timeout=window.setTimeout(function(){gifactif.reset(!0,gifactif.lang.searching),gifactif.request=$.get("https://api.giphy.com/v1/gifs/trending?limit="+gifactif.limit+"&rating=pg-13&api_key="+gifactif.key,function(e){gifactif.request=null,gifactif.offset=e.pagination.offset+gifactif.limit,gifactif.offset_total=e.pagination.total_count,gifactif.reset(!0),gifactif.addGIF(e),gaSendEvent("post_features","giphy","trending")})},gifactif.delay)},search:function(e){gifactif.timeout&&gifactif.abort(),e?gifactif.timeout=window.setTimeout(function(){gifactif.reset(!0,gifactif.lang.searching),gifactif.query=encodeURIComponent(e),gifactif.request=$.get("https://api.giphy.com/v1/gifs/search?q="+gifactif.query+"&limit="+gifactif.limit+"&rating=pg-13&api_key="+gifactif.key,function(e){gifactif.request=null,gifactif.offset=e.pagination.offset+gifactif.limit,gifactif.offset_total=e.pagination.total_count,gifactif.reset(!0),gifactif.addGIF(e),gaSendEvent("post_features","giphy","submit")})},gifactif.delay):gifactif.reset(!0)},abort:function(){gifactif.timeout&&(window.clearInterval(gifactif.timeout),gifactif.timeout=null),gifactif.request&&(gifactif.request.abort(),gifactif.request=null)},addGIF:function(e,t){var o=e.data,i=0,n=o.length,a=$('<div class="gifactif_imagelist" />')[0];if(n)for(;i<n;i++)a.appendChild($('<img id="'+o[i].id+'" src="'+o[i].images.fixed_width.url+'" />').click(gifactif.insert)[0]);else t||gifactif.reset(!0,gifactif.lang.not_found);$("#gifactif_results",gifactif.dropDown).append(a)},scrolling:function(e){e.scrollHeight-e.scrollTop===e.clientHeight&&gifactif.loadMore()},loadMore:function(){gifactif.offset<gifactif.offset_total&&(gifactif.query?gifactif.request=$.get("https://api.giphy.com/v1/gifs/search?q="+gifactif.query+"&offset="+gifactif.offset+"&limit="+gifactif.limit+"&rating=pg-13&api_key="+gifactif.key,function(e){gifactif.request=null,gifactif.offset=e.pagination.offset+gifactif.limit,gifactif.offset_total=e.pagination.total_count,gifactif.addGIF(e,!0),gaSendEvent("post_features","giphy","search_loadmore")}):gifactif.request=$.get("https://api.giphy.com/v1/gifs/trending?offset="+gifactif.offset+"&limit="+gifactif.limit+"&rating=pg-13&api_key="+gifactif.key,function(e){gifactif.request=null,gifactif.offset=e.pagination.offset+gifactif.limit,gifactif.offset_total=e.pagination.total_count,gifactif.addGIF(e,!0),gaSendEvent("post_features","giphy","trending_loadmore")}))},insert:function(){gifactif.callback("http://media0.giphy.com/media/"+this.id+"/giphy.gif"),gifactif.auto_close&&(gifactif.editor.closeDropDown(!0),gifactif.reset())},reset:function(e,t){$("#gifactif_results",gifactif.dropDown).html(t||""),e||$("#gifactif_search",gifactif.dropDown).val("")}},$("#gifactif_search",gifactif.dropDown)[0].onkeyup=function(e){e=e.keyCode;e&&(16==e||17==e||18==e||20==e||37==e||38==e||39==e||40==e)||gifactif.search(this.value)});